<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cat√°logo Digital ‚Äî Or√ßamento e WhatsApp</title>
  <style>
    :root {
      --accent:#d35400;
      --muted:#666;
      --card-bg:#fff;
      --page-bg:#f5f5f7;
    }
    body {
      font-family: Inter, Poppins, system-ui, Arial;
      background: var(--page-bg);
      margin:0;
      padding:20px;
      color:#222;
    }
    header {
      display:flex;
      align-items:center;
      gap:16px;
      margin-bottom:18px;
    }
    header img { width:56px; height:56px; border-radius:8px; object-fit:cover; }
    header h1 { font-size:20px; margin:0; }
    .layout { display:grid; grid-template-columns:1fr 380px; gap:18px; }
    .card { background:var(--card-bg); border-radius:10px; padding:12px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
    .products { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:12px; }
    .product { display:flex; flex-direction:column; border-radius:8px; overflow:hidden; }
    .product img { width:100%; height:140px; object-fit:cover; }
    .product .body { padding:10px; flex:1; display:flex; flex-direction:column; gap:8px; }
    .product h3 { margin:0; font-size:16px; }
    .product p { margin:0; color:var(--muted); font-size:13px; }
    .prices { display:flex; gap:8px; flex-wrap:wrap; font-size:14px; }
    .prices span { background:#f1f1f1; padding:4px 8px; border-radius:6px; }
    .controls { display:flex; gap:8px; align-items:center; margin-top:6px; }
    input[type="number"] { width:80px; padding:6px; border-radius:6px; border:1px solid #ddd; }
    button { background:var(--accent); color:#fff; border:0; padding:8px 12px; border-radius:8px; cursor:pointer; }
    .cart { max-height:70vh; overflow:auto; }
    .cart-item { display:flex; gap:8px; align-items:center; border-bottom:1px dashed #eee; padding:8px 0; }
    .cart-item img { width:56px; height:40px; object-fit:cover; border-radius:6px; }
    .cart-item .info { flex:1; }
    .small { font-size:13px; color:var(--muted); }
    .total { font-weight:700; font-size:18px; margin-top:12px; text-align:right; }
    .actions { display:flex; gap:8px; justify-content:space-between; margin-top:12px; }
    .note { font-size:13px; color:var(--muted); margin-top:8px; }
    .btn-secondary { background:#2d9cdb; }
    footer { margin-top:16px; text-align:center; color:var(--muted); font-size:13px; }
    .admin-controls { display:flex; gap:8px; margin-top:8px; }
    .produto-admin { border:1px solid #eee; padding:8px; border-radius:6px; margin-bottom:8px; }
    @media(max-width:900px){ .layout{grid-template-columns:1fr} }
  </style>
</head>
<body>

 <header style="
  background: linear-gradient(90deg, #27ae60, #2ecc71);
  color: white;
  border-radius: 12px;
  padding: 10px 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  margin-bottom: 18px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  text-align: center;
">
  <!-- Logo -->
  <img src="imagens/logo.jpeg" alt="Logo" 
       style="width: 56px; height: 56px; border-radius: 8px; object-fit: cover; margin-bottom: 8px;">

  <!-- Texto central -->
  <div style="flex: 1; min-width: 220px; text-align: center;">
    <h1 style="margin: 0; font-size: 18px; text-align: center;">
      Hortifruti Santo Ant√¥nio: Lugar de comprar barato
    </h1>
    <div style="margin-top: 4px; font-size: 14px; text-align: center;">
      Pe√ßa produtos pelo WhatsApp üì±
    </div>
  </div>

  <!-- Bot√£o Painel Admin -->
  <div style="margin-top: 8px;">
    <a href="#" id="adminLink" 
       style="color: #fff; font-weight: bold; background: rgba(0,0,0,0.2); padding: 6px 10px; border-radius: 6px; text-decoration: none; display: inline-block;">
       Painel Admin
    </a>
  </div>
</header>







  <div class="layout">
    <!-- PRODUTOS -->
    <div>
      <div class="card">
        <h2 style="margin:0 0 12px 0">Produtos</h2>
        <input type="text" id="searchInput" placeholder="üîç Pesquisar produto..." 
        style="width:100%; padding:8px; border-radius:8px; border:1px solid #ccc; margin-bottom:10px;">
        <div class="products" id="productsList"></div>
      </div>
    </div>

    <!-- CARRINHO / OR√áAMENTO -->
    <aside>
      <div class="card cart">
        <h2>Or√ßamento</h2>
        <div id="cartItems"><div class="small">Nenhum item ainda.</div></div>
        <div class="total" id="cartTotal">Total: R$ 0,00</div>

        <div class="card" style="margin-top:10px">
          <h3>Seus dados</h3>
          <label>Nome:</label>
          <input type="text" id="clientName" placeholder="Seu nome" style="width:100%;margin-bottom:6px;padding:6px;border-radius:6px;border:1px solid #ccc;">
          <label>Telefone:</label>
          <input type="text" id="clientPhone" placeholder="(DDD) 9xxxx-xxxx" style="width:100%;margin-bottom:6px;padding:6px;border-radius:6px;border:1px solid #ccc;">
          <label>Endere√ßo:</label>
          <textarea id="clientAddress" placeholder="Rua, n√∫mero, bairro..." style="width:100%;margin-bottom:6px;padding:6px;border-radius:6px;border:1px solid #ccc;"></textarea>
          <label>Troco para quanto?</label>
          <input type="text" id="clientChange" placeholder="Ex: R$ 50,00" style="width:100%;padding:6px;border-radius:6px;border:1px solid #ccc;">
        </div>

        <div class="actions">
          <button id="clearBtn" class="btn-secondary">Limpar</button>
          <button id="sendWhats" style="background:#25d366">Enviar pelo WhatsApp</button>
        </div>

        <div id="pix" style="margin-top:15px;text-align:center"></div>

        <div class="note">
          <strong>Nota:</strong> Clique em "limpar" para limpar o carrinho ou "enviar" para gerar o or√ßamento e o PIX.
        </div>
      </div>
    </aside>
  </div>

    <footer style="text-align:center; padding:10px; background-color:#f1f1f1; font-size:14px; color:#333;">
    ¬© <span id="year"></span> Hortifruti Santo Ant√¥nio ‚Äî Todos os direitos reservados.
    </footer>


  <!-- qrcode lib (para gerar imagem do QR) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <!-- Firebase + Firestore via CDN (module) -->
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getFirestore, collection, onSnapshot, setDoc , addDoc, deleteDoc, doc, updateDoc, getDocs, getDoc } 
    from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

   // === Verificar se compras est√£o liberadas ===
  
 

    // ====== Coloque SUA config do Firebase aqui (j√° voc√™ tem) ======
    const firebaseConfig = {
      apiKey: "AIzaSyDjzWfLJ5NbmD2MlfycN0FJc3UnvyeCX9s",
      authDomain: "catalogo-hortifruti.firebaseapp.com",
      projectId: "catalogo-hortifruti",
      storageBucket: "catalogo-hortifruti.firebasestorage.app",
      messagingSenderId: "38002725935",
      appId: "1:38002725935:web:91b94df5051a6317f2a2da"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function comprasLiberadas() {
    const ref = doc(db, 'config', 'geral'); // caminho do documento
    const snap = await getDoc(ref);
    if (!snap.exists()) return false; // se o documento n√£o existir, bloqueia
    return snap.data().comprasLiberadas === true;
  }

    // n√∫mero do vendedor para WhatsApp
    const sellerPhone = '5581986176915';

    // cart local (cliente)
    let cart = [];

    function formatBRL(v){ return 'R$ ' + Number(v||0).toFixed(2).replace('.', ','); }

    // mapear documento Firestore para formato que nosso app usa
    function mapDocToProduct(docSnap){
      const data = docSnap.data();
      // aceita formatos variados (nome / name / preco / priceUnit)
      const name = data.name ?? data.nome ?? 'Produto sem nome';
      const desc = data.desc ?? data.descricao ?? data.descri√ß√£o ?? '';
      const priceUnit = (data.priceUnit ?? data.preco ?? data.pre√ßo ?? data.price) ?? null;
      const priceKg = (data.priceKg ?? data.price_per_kg ?? null);
      const img = data.img ?? data.image ?? data.url ?? '';
      return {
        id: docSnap.id,
        name,
        desc,
        priceUnit: priceUnit !== null ? Number(priceUnit) : null,
        priceKg: priceKg !== null ? Number(priceKg) : null,
        img
      };
    }

    // render produtos (real-time via onSnapshot)
    const productsListEl = document.getElementById('productsList');
    let produtosSnapshotUnsub = null;

    // ========== BUSCA DE PRODUTOS ==========
    let allProducts = []; // armazenar√° todos os produtos carregados

    // Atualiza exibi√ß√£o conforme o termo pesquisado
    function applySearch() {
      const term = document.getElementById('searchInput').value.toLowerCase();
      const filtered = allProducts.filter(p => 
        p.name.toLowerCase().includes(term) || 
        (p.desc && p.desc.toLowerCase().includes(term))
      );
      renderProducts(filtered);
    }
    document.addEventListener('input', (e)=>{
      if(e.target.id === 'searchInput') applySearch();
    });


    function renderProducts(products){
      productsListEl.innerHTML = '';
      products.forEach(p=>{
        const div = document.createElement('div');
        div.className = 'product card';
        div.innerHTML = `
          <img src="${p.img || 'https://via.placeholder.com/400x300?text=Sem+imagem'}" alt="${p.name}">
          <div class="body">
            <h3>${p.name}</h3>
            <p class="small">${p.desc || ''}</p>
            <div class="prices">
              ${p.priceUnit!=null?`<span>Unid: ${formatBRL(p.priceUnit)}</span>`: ''}
              ${p.priceKg!=null?`<span>Kg: ${formatBRL(p.priceKg)}</span>`: ''}
            </div>
            <div class="controls">
              <label><input type="radio" name="mode_${p.id}" value="unit" ${p.priceUnit==null?'disabled':'checked'}> Unid</label>
              <label><input type="radio" name="mode_${p.id}" value="kg" ${p.priceKg==null?'disabled':''}> Kg</label>
              <input type="number" min="0.01" step="0.01" value="1" id="qty_${p.id}">
              <button data-id="${p.id}">Adicionar</button>
            </div>
          </div>`;
        productsListEl.appendChild(div);

        div.querySelector('button').addEventListener('click', ()=>{
          const mode = div.querySelector(`input[name="mode_${p.id}"]:checked`)?.value;
          const qty = parseFloat(document.getElementById(`qty_${p.id}`).value);
          if(!mode || isNaN(qty) || qty <= 0){ alert('Escolha modo e quantidade v√°lida.'); return; }
          const price = (mode === 'kg') ? p.priceKg : p.priceUnit;
          addToCart({ productId: p.id, mode, qty, unitPrice: price, name: p.name, img: p.img });
        });
      });
    }

    // carregar produtos em tempo real
    function startRealtimeProducts(){
      const col = collection(db, 'produtos');
      produtosSnapshotUnsub = onSnapshot(col, (snapshot)=>{
        const items = snapshot.docs.map(mapDocToProduct);
        allProducts = items; // salva todos
        renderProducts(allProducts); // mostra tudo

      }, (err)=>{ console.error('Erro onSnapshot produtos:', err); alert('Erro ao carregar produtos. Verifique console.'); });
    }

    startRealtimeProducts();

    // CART
    function addToCart(item){
    const exist = cart.find(c=>c.productId===item.productId && c.mode===item.mode);
    if(exist) exist.qty = Number(exist.qty) + Number(item.qty);
    else cart.push(item);
    renderCart();
  }
    function removeFromCart(i){ cart.splice(i,1); renderCart(); }
    function clearCart(){ if(confirm('Limpar carrinho?')){ cart=[]; renderCart(); } }
    function calcTotal(){ return cart.reduce((s,it)=> s + (Number(it.unitPrice||0) * Number(it.qty||0)), 0); }

    function renderCart(){
    const el = document.getElementById('cartItems');
    el.innerHTML = '';
    if(cart.length === 0){ el.innerHTML = '<div class="small">Nenhum item ainda.</div>'; }
    else {
      cart.forEach((it,i)=>{
        const name = it.name || it.productId;
        el.innerHTML += `
          <div class="cart-item">
            <img src="${it.img || 'https://via.placeholder.com/60x40?text=Sem+imagem'}" alt="${name}">
              <div class="info">
              <strong>${name}</strong><br>
              <span class="small">${it.qty} ${it.mode==='kg'?'kg':'un.'} √ó ${formatBRL(it.unitPrice)}</span>
            </div>
            <button style="background:#e74c3c" onclick="removeFromCart(${i})">Remover</button>
          </div>
        `;
      });
    }
    document.getElementById('cartTotal').textContent = 'Total: ' + formatBRL(calcTotal());

    // üî• Linha nova: atualiza PIX automaticamente
    atualizarPix();
  }


    // gerar mensagem e PIX
    function generateMessage(){
      const name = document.getElementById('clientName').value.trim() || 'N√£o informado';
      const phone = document.getElementById('clientPhone').value.trim() || 'N√£o informado';
      const addr = document.getElementById('clientAddress').value.trim() || 'N√£o informado';
      const troco = document.getElementById('clientChange').value.trim() || 'N√£o informado';
      const lines = ['üõí *NOVO OR√áAMENTO DE CLIENTE*','','üì¶ *Itens:*',''];
      cart.forEach((it,i)=>{
        const subtotal = Number(it.unitPrice||0) * Number(it.qty||0);
        lines.push(`${i+1}. ${it.name || it.productId} ‚Äî ${it.qty} ${it.mode} a ${formatBRL(it.unitPrice)} = ${formatBRL(subtotal)}`);
      });
      lines.push('', `üí∞ *Total:* ${formatBRL(calcTotal())}`, '', `üë§ *Cliente:* ${name}`, 'üìû '+phone, 'üè† '+addr, 'üíµ Troco para: '+troco, '', 'üü¢ Enviado automaticamente pelo cat√°logo digital.');
      return lines.join('\n');
    }

    // Fun√ß√£o simples para montar um payload PIX (SIMPLIFICADO)
    function buildPixPayload(nomeTitular, chavePix, cidade, valor, descricao) {
    const amount = Number(valor||0).toFixed(2);
    let payload = `00020126360014BR.GOV.BCB.PIX01${String(chavePix).length.toString().padStart(2,'0')}${chavePix}520400005303986540${amount}5802BR5913${nomeTitular.substring(0,13)}6009${cidade.substring(0,9)}62070503***6304`;
    return payload.replace(/\s+/g,'');
  }


    // gerar PIX visual (QR code + copia e cola)
    async function atualizarPix() {
    const total = calcTotal();
    const pixDiv = document.getElementById('pix');

    // Se carrinho estiver vazio, limpa
    if (total === 0) {
      pixDiv.innerHTML = '';
      return;
    }

    // Verifica se compras est√£o liberadas
    const ref = doc(db, 'config', 'geral');
    const snap = await getDoc(ref);
    const ativo = snap.exists() && snap.data().comprasLiberadas === true;

    if (!ativo) {
      // Se estiver bloqueado, mostra aviso e n√£o gera PIX
      pixDiv.innerHTML = `
        <p><b>Valor:</b> ${formatBRL(total)}</p>
        <p style="color:red;font-weight:bold;">
          ‚ö†Ô∏è As compras est√£o bloqueadas.<br>
          O PIX ser√° exibido quando as compras forem liberadas.
        </p>
      `;
      return;
    }

    // Se estiver liberado, gera normalmente o PIX
    const nome = "HORTIFRUTI SANTO ANTONIO";
    const chavePix = "suachavepix@banco.com";
    const cidade = "Recife";
    const descricao = "Pagamento pedido Hortifruti";

    const payload = buildPixPayload(nome, chavePix, cidade, total, descricao);

    QRCode.toDataURL(payload, { width: 200 }, function(err, url) {
      if (err) { console.error(err); return; }
      pixDiv.innerHTML = `
        <p><b>Valor:</b> ${formatBRL(total)}</p>
        <img src="${url}" alt="QR Code PIX">
        <p><small>C√≥digo copia e cola:</small></p>
        <textarea readonly rows="3" style="width:100%">${payload}</textarea>
      `;
    });
  }


  function gerarMensagemWhatsApp() {
  const total = calcTotal();
  let mensagem = "üõí *Or√ßamento Hortifruti Santo Ant√¥nio*\n\n";
  mensagem += `üë§ *Nome:* ${clientName.value || 'N√£o informado'}\n`;
  mensagem += `üìû *Telefone:* ${clientPhone.value || 'N√£o informado'}\n`;
  mensagem += `üè† *Endere√ßo:* ${clientAddress.value || 'N√£o informado'}\n`;
  if(clientChange.value) mensagem += `üíµ *Troco para:* ${clientChange.value}\n`;

  mensagem += "\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nüçé Produtos selecionados:\n";
  cart.forEach((item, index) => {
    mensagem += `${index+1}Ô∏è‚É£ *${item.name}*\n`;
    mensagem += `   - Pre√ßo: ${formatBRL(item.unitPrice)}\n`;
    mensagem += `   - Quantidade: ${item.qty}\n`;
  });

  mensagem += "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n";
  mensagem += `üí∞ *Total:* ${formatBRL(total)}\n\n`;

  // C√≥digo PIX de copia e cola
  const payload = buildPixPayload("HORTIFRUTI SANTO ANTONIO", "suachavepix@banco.com", "Recife", total, "Pagamento pedido Hortifruti");

  mensagem += `üìå Fa√ßa seu pagamento via PIX (copia e cola):\n${payload}\n\n`;

  mensagem += "Muito obrigado pela prefer√™ncia! üòÑ";

  return encodeURIComponent(mensagem);
}

// Atualiza os pre√ßos do carrinho com base nos dados atuais do Firestore
async function atualizarPrecosCarrinho() {
  const col = collection(db, 'produtos');
  const snap = await getDocs(col);
  const mapaAtual = {};
  snap.forEach(docSnap => {
    const p = mapDocToProduct(docSnap);
    mapaAtual[p.id] = p;
  });

  // Atualiza cada item do carrinho
  cart = cart.map(item => {
    const atualizado = mapaAtual[item.productId];
    if (atualizado) {
      item.unitPrice = item.mode === 'kg' ? atualizado.priceKg : atualizado.priceUnit;
      item.name = atualizado.name;
      item.img = atualizado.img;
    }
    return item;
  });

  renderCart(); // atualiza a tela com os novos valores
}

// listeners botoes
  document.getElementById('sendWhats').addEventListener('click', async () => {
  const docRef = doc(db, 'config', 'geral');
  const snap = await getDoc(docRef);
  const ativo = snap.exists() && snap.data().comprasLiberadas === true;

  if(!ativo){
    alert('üö´ As compras ainda n√£o est√£o liberadas.\nAguarde autoriza√ß√£o da loja.');
    return;
  }

  // üî• Atualiza os pre√ßos com os valores atuais do Firestore
  await atualizarPrecosCarrinho();


  const msg = gerarMensagemWhatsApp();
  const url = `https://wa.me/${sellerPhone}?text=${msg}`;
  window.open(url, '_blank');
});



  // Verifica no Firestore se as compras est√£o liberadas
  



  


  

  const total = calcTotal(); // calcula total do carrinho

  // Gera PIX visual
  


    // ===== ADMIN PANEL =====
    const adminLink = document.getElementById('adminLink');

    // senha simples (est√° no c√≥digo) ‚Äî troque se quiser
    const ADMIN_PASSWORD = "2427@";

    // modal simples (criamos dinamicamente)
    const adminLoginModal = document.createElement('div');
    adminLoginModal.style.display = 'none';
    adminLoginModal.style.position = 'fixed';
    adminLoginModal.style.top = '20%';
    adminLoginModal.style.left = '50%';
    adminLoginModal.style.transform = 'translateX(-50%)';
    adminLoginModal.style.background = '#fff';
    adminLoginModal.style.padding = '18px';
    adminLoginModal.style.borderRadius = '8px';
    adminLoginModal.style.boxShadow = '0 4px 16px rgba(0,0,0,0.2)';
    adminLoginModal.style.zIndex = '9999';
    adminLoginModal.innerHTML = `
      <h3>Login Administrador</h3>
      <label>Senha:</label><br>
      <input type="password" id="adminPassLocal" style="padding:6px;margin-top:6px;width:100%"><br>
      <div style="margin-top:10px;text-align:right">
        <button id="adminCancelLocal" style="background:#ccc;color:#000;padding:6px 10px;margin-right:6px">Cancelar</button>
        <button id="adminSubmitLocal" style="background:var(--accent);color:#fff;padding:6px 10px">Entrar</button>
      </div>
    `;
    document.body.appendChild(adminLoginModal);
    document.getElementById('adminLink').addEventListener('click', (e)=>{ e.preventDefault(); adminLoginModal.style.display='block'; document.getElementById('adminPassLocal').value=''; document.getElementById('adminPassLocal').focus(); });
    document.getElementById('adminCancelLocal').addEventListener('click', ()=> adminLoginModal.style.display='none');
    document.getElementById('adminSubmitLocal').addEventListener('click', ()=> {
      const v = document.getElementById('adminPassLocal').value;
      if(v === ADMIN_PASSWORD){ adminLoginModal.style.display='none'; openAdminPanel(); }
      else { alert('Senha incorreta!'); document.getElementById('adminPassLocal').value=''; document.getElementById('adminPassLocal').focus(); }
    });

    // fun√ß√£o que abre painel admin com op√ß√µes e usa Firestore para CRUD
    async function openAdminPanel(){
      // painel simples com bot√µes
      const panel = document.createElement('div');
      panel.style.position='fixed';
      panel.style.top='10%';
      panel.style.left='50%';
      panel.style.transform='translateX(-50%)';
      panel.style.width='90%';
      panel.style.maxWidth='720px';
      panel.style.background='#fff';
      panel.style.padding='12px';
      panel.style.borderRadius='8px';
      panel.style.boxShadow='0 6px 24px rgba(0,0,0,0.2)';
      panel.style.zIndex='9999';

      panel.innerHTML = `
      <h3>Painel Admin</h3>
      <div class="admin-controls">
        <button id="btnAddAdmin">Adicionar Produto</button>
        <button id="btnToggleCompras" style="background:#27ae60">Liberar/Bloquear Compras</button>
        <button id="btnCloseAdmin" style="background:#ccc;color:#000">Fechar</button>
      </div>
      <div id="statusCompras" class="small" style="margin-top:6px;color:#555;"></div>
      <div id="adminProductsList" style="margin-top:12px; max-height:60vh; overflow:auto"></div>
    `;

      document.body.appendChild(panel);

      panel.querySelector('#btnCloseAdmin').addEventListener('click', ()=>{ panel.remove(); });

    async function loadAdminProducts(){
  const listEl = panel.querySelector('#adminProductsList');
  listEl.innerHTML = '<div class="small">Carregando...</div>';
  const snap = await getDocs(collection(db,'produtos'));
  listEl.innerHTML = '';

  snap.forEach(d=>{
    const p = mapDocToProduct(d);
    const node = document.createElement('div');
    node.className = 'produto-admin';
    node.innerHTML = `
      <strong>${p.name}</strong> <span style="color:var(--muted)">(${p.id})</span><br>
      <div class="small">${p.desc || ''}</div>
      <div style="margin-top:8px">
        <button data-id="${d.id}" class="btn-edit">Editar</button>
        <button data-id="${d.id}" class="btn-del" style="background:#e74c3c">Remover</button>
      </div>
    `;
    listEl.appendChild(node);
  });

  // === STATUS DE COMPRAS (liberar/bloquear) ===
  async function atualizarStatusCompras(){
    const docRef = doc(db, 'config', 'geral');
    const snap = await getDoc(docRef);
    const ativo = snap.exists() && snap.data().comprasLiberadas === true;
    panel.querySelector('#statusCompras').textContent = ativo ? 
      'üü¢ Compras est√£o LIBERADAS' : 
      'üî¥ Compras est√£o BLOQUEADAS';
    panel.querySelector('#btnToggleCompras').textContent = ativo ? 'Bloquear Compras' : 'Liberar Compras';
  }

  panel.querySelector('#btnToggleCompras').addEventListener('click', async ()=>{
    const docRef = doc(db, 'config', 'geral');
    const snap = await getDoc(docRef);
    const atual = snap.exists() && snap.data().comprasLiberadas === true;
    await setDoc(docRef, { comprasLiberadas: !atual });
    atualizarStatusCompras();
  });

  // inicializa status
  atualizarStatusCompras();

  // attach edit/delete (agora que listEl est√° populado)
  listEl.querySelectorAll('.btn-edit').forEach(b => {
    b.addEventListener('click', async () => {
      const id = b.dataset.id;

      const novoNome = prompt('Nome do produto:') || null;
      if (novoNome === null) return;
      const novaDesc = prompt('Descri√ß√£o:') || '';
      const novoPrecoUnit = prompt('Pre√ßo por unidade (deixe vazio para null):') || '';
      const novoPrecoKg = prompt('Pre√ßo por kg (deixe vazio para null):') || '';
      const novaImg = prompt('URL da imagem:') || '';

      const ref = doc(db, 'produtos', id);
      const payload = {};

      if (novoNome !== '' && novoNome !== null) payload.name = novoNome;
      if (novaDesc !== '' && novaDesc !== null) payload.desc = novaDesc;
      if (novaImg !== '' && novaImg !== null) payload.img = novaImg;
      if (novoPrecoUnit !== '') payload.priceUnit = Number(novoPrecoUnit.replace(',', '.'));
      if (novoPrecoKg !== '') payload.priceKg = Number(novoPrecoKg.replace(',', '.'));

      if (Object.keys(payload).length === 0) {
        alert('Nenhuma altera√ß√£o feita.');
        return;
      }

      await updateDoc(ref, payload);
      alert('Produto atualizado!');
      loadAdminProducts(); // recarrega a lista
    });
  });

  listEl.querySelectorAll('.btn-del').forEach(b => {
    b.addEventListener('click', async () => {
      const id = b.dataset.id;
      if (confirm('Deseja remover este produto?')) {
        await deleteDoc(doc(db, 'produtos', id));
        alert('Removido com sucesso!');
        loadAdminProducts();
      }
    });
  });
}


      panel.querySelector('#btnAddAdmin').addEventListener('click', async ()=> {
      const nome = prompt('Nome do produto:'); if(!nome) return;
      const descricao = prompt('Descri√ß√£o:') || '';
      const precoUnit = prompt('Pre√ßo por unidade (ou vazio):') || '';
      const precoKg = prompt('Pre√ßo por kg (ou vazio):') || '';
      const img = prompt('URL da imagem (p√∫blica):') || '';
      await addDoc(collection(db,'produtos'), {
        name: nome,
        desc: descricao,
        img: img,
        priceUnit: precoUnit === '' ? null : Number(precoUnit.replace(',','.')),
        priceKg: precoKg === '' ? null : Number(precoKg.replace(',','.'))
      });
      alert('Produto adicionado!');
      loadAdminProducts();
    });


      // inicial
      loadAdminProducts();
    }

    // expose removeFromCart for onclick inline
    window.removeFromCart = removeFromCart;

    //coloca o ano atual na footer 
  document.getElementById('year').textContent = new Date().getFullYear();

  </script>

  
</body>
</html>
